<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Telegram WebApp demo</title>
</head>
<body>
  <h1></h1>
  <p id="info"></p>
  <button id="sendBtn">Включить уведомления</button>

  <script>
    // доступ к API Telegram WebApp
    const tg = window.Telegram?.WebApp;
    if (!tg) {
      document.getElementById('info').innerText = 'Не в Telegram WebApp.';
    } else {
      // initDataUnsafe содержит объект user, но НЕ доверяй ему на сервере без проверки
      const unsafe = tg.initDataUnsafe || {};
      const user = unsafe.user || {};
      document.getElementById('info').innerText =
        `Пользователь: ${user.username||'(нет username)'} (id: ${user.id||'(нет id)'}).`;

      document.getElementById('sendBtn').addEventListener('click', () => {
        // 1) простой способ: отправить прямо боту через sendData
        const payload = {
          username: user.username || null,
          id: user.id || null,
          // можно добавить какую-то метку/время:
          ts: Date.now()
        };
        // Telegram.WebApp.sendData отправит строку боту как service message
        tg.sendData(JSON.stringify(payload));

        // 2) альтернативно: послать на свой сервер (если нужен сервер),
        // но тогда ОБЯЗАТЕЛЬНО в теле запроса приложить tg.initData и валидировать подпись на сервере.
        // fetch('/collect', {method:'POST', body: JSON.stringify({payload, initData: tg.initData})})
      });
    }
  </script>
</body>
</html>


